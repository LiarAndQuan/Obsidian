## 索引

### 1.主要索引结构

|      索引结构       | 描述                                                                            |
|:-------------------:| ------------------------------------------------------------------------------- |
|     B+Tree     | 最常见的索引类型，大部分引擎都支持 B+ 树索引                                    |
|        Hash         | 底层数据结构是用哈希表实现的, 只有精确匹配索引列的查询才有效, 不 支持范围查询   |
|  R-tree(空间索引)   | 空间索引是MyISAM引擎的一个特殊索引类型，主要用于地理空间数据类 型，通常使用较少 |
| Full-text(全文索引) | 是一种通过建立倒排索引,快速匹配文档的方式。类似于 Lucene,Solr,ES                |

不同的存储引擎对于索引结构的支持情况不同 :

|   索引    |   InnoDB    | MyISAM | Memory |
|:---------:|:-----------:|:------:|:------:|
|  B+tree   |    支持     |  支持  |  支持  |
|   Hash    |   不支持    | 不支持 |  支持  |
|  R-tree   |   不支持    |  支持  | 不支持 |
| Full-text | 5.6之后支持 |  支持  | 不支持 |

>我们平常所说的索引，如果没有特别指明，都是指B+树结构组织的索引

### 2.B+Tree结构

#### 1.BTree

>B树是一种多叉路衡查找树，相对于二叉树，B树每个节点可以有多个分支，即多叉。 以一颗最大度数（max-degree）为5(5阶)的b-tree为例，那这个B树每个节点最多存储4个key，5 个指针

![[Attachments/Images/Pasted image 20231209134752.png]]

特点 :

1. 5阶的B树，每一个节点最多存储4个key，对应5个指针
2. 一旦节点存储的key数量到达5，就会裂变，中间元素向上分裂
3. 在B树中，非叶子节点和叶子节点都会存放数据

#### 2.B+Tree

>我们以一颗最大度数（max-degree）为4（4阶）的b+tree为例，来看一 下其结构示意图：

![[Attachments/Images/Pasted image 20231209135004.png]]

B+Tree 与 B-Tree相比，主要有以下三点区别：

1. 所有的数据都会出现在叶子节点
2. 叶子节点形成一个单向链表
3. 非叶子节点仅仅起到索引数据作用，具体的数据都是在叶子节点存放的

#### 3.Mysql优化后的B+Tree

>MySQL索引数据结构对经典的B+Tree进行了优化。在原B+Tree的基础上，增加一个指向相邻叶子节点 的链表指针，就形成了带有顺序指针的B+Tree，提高区间访问的性能，利于排序

![[Attachments/Images/Pasted image 20231209135202.png]]

### 3.索引分类

在MySQL数据库，将索引的具体类型主要分为以下几类：主键索引、唯一索引、常规索引、全文索引 :

| 分类     | 含义 | 特点 | 关键字 |
| -------- | ---- | ---- | ------ |
| 主键索引 | 针对于表中主键创建的索引 |默认自动创建, 只能 有一个 |PRIMARY  |
| 唯一索引 |避免同一个表中某数据列中的值重复 |可以有多个 |UNIQUE|
| 常规索引 | 快速定位特定数据 |  可以有多个 |        |
| 全文索引         |全文索引查找的是文本中的关键词，而不是比 较索引中的值 |可以有多个  |FULLTEXT  |

而在在InnoDB存储引擎中，根据索引的存储形式，又可以分为以下两种：

| 分类                      | 含义                                                        | 特点                 |
| ------------------------- | ----------------------------------------------------------- | -------------------- |
| 聚集索引(Clustered Index) | 将数据存储与索引放到了一块，索引结构的叶子 节点保存了行数据 | 必须有,而且只 有一个 |
| 二级索引(Secondary Index)    | 将数据与索引分开存储，索引结构的叶子节点关 联的是对应的主键           | 可以存在多个     |

聚集索引选取规则 :

1. 如果存在主键，主键索引就是聚集索引
2. 如果不存在主键，将使用第一个唯一（UNIQUE）索引作为聚集索引
3. 如果表没有主键，或没有合适的唯一索引，则InnoDB会自动生成一个rowid作为隐藏的聚集索引

![[Attachments/Images/Pasted image 20231209140002.png]]

### 4.索引语法

```mysql
#创建索引
create [unique|fulltext] index index_name on table_name(index_col_name,...);
#查看索引
show index from table_name;
#删除索引
drop index index_name on table_name;
```

